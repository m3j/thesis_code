rm(list=ls())
rm(list=ls())
setwd("C:/Users/schau/Desktop/Kaiju")
getwd(
)
library(tidyverse)
library(broom)
library(phyloseq)
library(DAtest)
library(vegan)
library(stringr)
library(ggthemes)
# getwd()
# setwd("~/")
otutab <- read.csv("chick_kaiju.otu.tab", sep = "\t", row.names = 1, header = TRUE)
View(otutab)
View(otutab)
otutab_oknames <- otutab %>%
rename_at(vars(ends_with("_out")), funs(str_replace(., "_out", "")))
colnames(otutab_oknames)
OTU = otu_table(otutab_oknames, taxa_are_rows = TRUE)
taxtab <- read.csv("chick_kaiju.tax.tab", sep = "\t", row.names = 1, header = TRUE)
taxmat = as.matrix(taxtab)
TAX = tax_table(taxmat)
setdiff(rownames (otutab_oknames), rownames(taxmat))
getwd()
metadata = read.csv("../metadata_out.tsv", sep = "\t", skip=1, header=FALSE)
metadata = read.csv("data56_related_files/metadata_out.tsv", sep = "\t", skip=1, header=FALSE)
metadata = read.csv("~/Documents/DTU/thesis/thesis_code/data56_related_files/metadata_out.tsv", sep = "\t", skip=1, header=FALSE)
metadata = read.csv("../metadata_out.tsv", sep = "\t", skip=1, header=FALSE)
View(metadata)
metadata = read.csv("../metadata_out.tsv", sep = ",", skip=1, header=FALSE)
View(metadata)
metadata = read.csv("../metadata_out.tsv", sep = ",", skip=1, header=TRUE)
metadata = read.csv("../metadata_out.tsv", sep = ",", header=TRUE)
View(metadata)
META = sample_data(metadata)
rownames(META) <-metadata$ID
physeq = phyloseq(OTU, TAX, META)
physeq
saveRDS(physeq, "chicken.phyloseq.rds")
physeq_df <- psmelt(physeq)
rawkaijubarplot <- ggplot(physeq_df, aes(x = Sample, y = Abundance, fill = Domain)) + theme_bw() +   geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle=90, size=6))
rawkaijubarplot
dir.create("Results")
dir.create("Results")
ggsave("Results/rawkaijubarplot.png")
physeq_genus_cutoff = preDA(physeq, min.reads = 1000)
glom_or <- tax_glom(physeq_genus_cutoff, taxrank ="Genus")
gpt <- subset_taxa(glom_or)
gpt <- prune_taxa(names(sort(taxa_sums(glom_or),TRUE)[1:30]), glom_or)
top25 <- names(sort(taxa_sums(gpt), decreasing=TRUE))[1:30]
ps.top25 <- transform_sample_counts(gpt, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink")
pspe <- plot_bar(ps.top25, fill = "Genus") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)  +
theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe <- plot_bar(ps.top25, fill = "Genus") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "bold", size=10),
axis.text.y = element_text(face = "bold", size=10),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=9),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=10),
axis.text.y = element_text(face = "bold", size=10),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=9),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
metadata = read.csv("../Metadata_56samples.tsv", sep = "\t", header=TRUE)
META = sample_data(metadata)
rownames(META) <-metadata$ID
physeq = phyloseq(OTU, TAX, META)
physeq
saveRDS(physeq, "chicken.phyloseq.rds")
physeq_df <- psmelt(physeq)
rawkaijubarplot <- ggplot(physeq_df, aes(x = Sample, y = Abundance, fill = Domain)) + theme_bw() +   geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle=90, size=6))
rawkaijubarplot
dir.create("Results")
ggsave("Results/rawkaijubarplot.png", width = unit(15,"cm"))
physeq_genus_cutoff = preDA(physeq, min.reads = 1000)
glom_or <- tax_glom(physeq_genus_cutoff, taxrank ="Genus")
gpt <- subset_taxa(glom_or)
gpt <- prune_taxa(names(sort(taxa_sums(glom_or),TRUE)[1:30]), glom_or)
top25 <- names(sort(taxa_sums(gpt), decreasing=TRUE))[1:30]
ps.top25 <- transform_sample_counts(gpt, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink")
pspe <- plot_bar(ps.top25, fill = "Genus") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=9),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/genus_abundance.png", width = unit(15,"cm"))
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/genus_abundance.png", width = unit(15,"cm"))
physeq_family_cutoff = preDA(physeq, min.reads = 1000)
glom_or_fam <- tax_glom(physeq_family_cutoff, taxrank ="Family")
gpt_fam <- subset_taxa(glom_or_fam)
gpt_fam <- prune_taxa(names(sort(taxa_sums(glom_or_fam),TRUE)[1:30]), glom_or_fam)
top25_fam <- names(sort(taxa_sums(gpt_fam), decreasing=TRUE))[1:30]
ps.top25_fam <- transform_sample_counts(gpt_fam, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", )
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", "cornsilk2")
vf2
pspe_fam <- plot_bar(ps.top25_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance.png", width = unit(15,"cm"))
pspe_fam <- plot_bar(ps.top25_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = col)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance.png", width = unit(15,"cm"))
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", "cornsilk2")
pspe_fam <- plot_bar(ps.top25_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance.png", width = unit(15,"cm"))
top15_fam <- names(sort(taxa_sums(gpt_fam), decreasing=TRUE))[1:30]
ps.top15_fam <- transform_sample_counts(gpt_fam, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", "cornsilk2")
pspe_fam <- plot_bar(ps.top15_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance_top15.png", width = unit(15,"cm"))
top15_fam <- names(sort(taxa_sums(gpt_fam), decreasing=TRUE))[1:15]
ps.top15_fam <- transform_sample_counts(gpt_fam, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", "cornsilk2")
pspe_fam_15 <- plot_bar(ps.top15_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = vf2)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam_15 + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance_top15.png", width = unit(15,"cm"))
col15 = c("burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "brown1",
"darkseagreen1","darkseagreen3",
"steelblue1","brown3","red2","steelblue3",
"lightsteelblue1","coral",
"sienna1")
pspe_fam_15 <- plot_bar(ps.top15_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = col15)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam_15 + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
gpt_fam <- prune_taxa(names(sort(taxa_sums(glom_or_fam),TRUE)[1:15]), glom_or_fam)
top15_fam <- names(sort(taxa_sums(gpt_fam), decreasing=TRUE))[1:15]
ps.top15_fam <- transform_sample_counts(gpt_fam, function(OTU) 100* OTU/sum(OTU))
vf2=c("peachpuff2","burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "lightgoldenrod1", "brown1",
"darkseagreen1",  "seagreen1","darkseagreen3","steelblue3",
"steelblue1","brown3","red2","steelblue3",  "steelblue1", "skyblue1",
"lightsteelblue1", "lightblue2","lightsteelblue", "lightcyan1","coral",
"sienna1","tan1","orange","brown3","lightsalmon","red2")
col = c('#e6194b', '#3cb44b', '#ffe119', '#4363d8', '#f58231', '#911eb4',
'#46f0f0', '#f032e6', '#bcf60c', '#fabebe', '#008080', '#e6beff',
'#9a6324', '#fffac8', '#800000', '#aaffc3', '#808000', '#ffd8b1',
'#000075', '#808080', '#ffffff', '#000000', "red", "pink", "cornsilk2")
col15 = c("burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "brown1",
"darkseagreen1","darkseagreen3",
"steelblue1","brown3","red2","steelblue3",
"lightsteelblue1","coral",
"sienna1")
pspe_fam_15 <- plot_bar(ps.top15_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = col15)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam_15 + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance_top15.png", width = unit(15,"cm"))
col15 = c("burlywood2","Peachpuff","blanchedalmond",
"palegoldenrod","lemonchiffon1", "brown1",
"darkseagreen1","darkseagreen3",
"steelblue1","brown3","lightsalmon","steelblue3",
"lightsteelblue1","coral",
"sienna1")
pspe_fam_15 <- plot_bar(ps.top15_fam, fill = "Family") + ylab("Relative abundance %") +
geom_bar(stat= "identity", color="gray") + scale_fill_manual(values = col15)
# +
# theme(axis.ticks.x = element_blank()) + scale_x_discrete(limits = positions)
pspe_fam_15 + theme(panel.grid.major = element_blank(),
axis.title.y =element_text(face = "bold", size=11),
axis.text.x  = element_text(face = "italic", size=12),
axis.text.y = element_text(face = "bold", size=12),
legend.title = element_text(face = "bold", size=10),
legend.text = element_text(face = "italic", size=12),
legend.key.size = unit(0.5, "cm"),
panel.grid.minor = element_blank(),
panel.background = element_blank())
ggsave("Results/family_abundance_top15.png", width = unit(15,"cm"))
